{"remainingRequest":"/home/donghai/Desktop/www/clover/public/source/admin/node_modules/_vue-loader@15.7.2@vue-loader/lib/index.js??vue-loader-options!/home/donghai/Desktop/www/clover/public/source/admin/src/views/content/CaseView.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/donghai/Desktop/www/clover/public/source/admin/src/views/content/CaseView.vue","mtime":1574999406000},{"path":"/home/donghai/Desktop/www/clover/public/source/admin/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/donghai/Desktop/www/clover/public/source/admin/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/donghai/Desktop/www/clover/public/source/admin/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/donghai/Desktop/www/clover/public/source/admin/node_modules/_vue-loader@15.7.2@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport TinymceEditor from '../../components/Tinymce'\nexport default {\n  components: {\n    TinymceEditor\n  },\n  data () {\n    return {\n      albumCount: 5,\n      albumUpload: true,\n      file_size: JSON.parse(localStorage.getItem('config')).file_size,\n      uploadUrl: this.api.common.upload,\n      contentType: 'case',\n      cascader: [],\n      data:[],\n      attribute:[],\n      album: [],\n      formItem: {\n        id: 0,\n        title: '',\n        is_offer: false,\n        is_recommend: false,\n        image: '',\n        content: '',\n        category_id: [0],\n      },\n      ruleValidate: {\n        title: [\n          { required: true, message: '标题不能为空', trigger: 'blur' },\n          { type: 'string', min: 2, message: '标题必须大于 2 个字', trigger: 'blur' },\n          { type: 'string', max: 200, message: '标题必须小于200 个字', trigger: 'blur' },\n        ],\n      }\n    }\n  },\n  created() {\n    this.uploadUrl = this.uploadUrl + '?module=' + this.contentType\n    this.attribute = JSON.parse(localStorage.getItem('config'))['product_attribute']\n\n    // 所属栏目\n    var url = this.api.category.cascaderContent + this.contentType;\n    this.$axios.get(url)\n      .then((response) => {\n        if (response.data.code == 0)\n        {\n          this.cascader = response.data.data\n        }else{\n          this.$Message.error('数据获取失败，请检查');\n        }\n      })\n    //表单内容\n    if (this.$route.query.id > 0)\n    {\n      this.$axios.get(this.api.content.view + this.contentType + '/' + this.$route.query.id)\n        .then((response) => {\n          if (response.data.code == 0)\n          {\n            this.formItem = response.data.data\n            if (response.data.data.attribute != null && JSON.parse(response.data.data.attribute).length > 0)\n            {\n              let attribute = JSON.parse(response.data.data.attribute)\n              for (let i = 0; i < attribute.length; i++) {\n                this.attribute[i] = attribute[i]\n              }\n            }\n            if (response.data.data.album != null)\n            {\n              let album = JSON.parse(response.data.data.album)\n              this.album = album\n              this.albumUpload = album.length >= this.albumCount ? false : true\n            }\n          }else{\n            this.$Message.error('数据获取失败，请检查');\n          }\n        })\n    }\n  },\n  methods: {\n    resetAlbum () {\n      this.albumUpload = true\n      this.album = []\n    },\n    imgUrl(src)\n    {\n      window.console.log(src.length)\n      if(src.length <= 0)\n      {\n        this.$Message.error('尚未上传图片，无法查看')\n        return false\n      }\n      if(src.substr(0,4).toLowerCase() != \"http\")\n      {\n        src = this.api.static.baseUrl + src;\n      }\n      return src\n    },\n    viewPic (src) {\n      if(src.length <= 0)\n      {\n        this.$Message.error('尚未上传图片，无法查看')\n        return false\n      }\n      src = this.imgUrl(src)\n      const title = '查看图片';\n      const content = '<img style=\"width: 88%\" src=\"' + src +'\">';\n      this.$Modal.info({\n        title: title,\n        content: content\n      });\n    },\n    handleSuccessAlbum (response) {\n      this.album.push({\n        src: this.imgUrl(response.data.url)\n      })\n      if(this.album.length > this.albumCount - 1)\n      {\n        this.albumUpload = false\n      }\n      this.$Message.success('上传成功')\n    },\n    handleSuccess (response) {\n      this.formItem.image = response.data.url\n      this.$Message.success('上传成功')\n    },\n    handleVideoSuccess (response) {\n      this.formItem.video = response.data.url\n      this.$Message.success('上传成功')\n    },\n    handleError (event) {\n      window.console.log(event)\n      this.$Message.error('上传错误，请重新上传')\n\n    },\n    handleFormatError (file) {\n      this.$Notice.warning({\n        title: '文件格式错误',\n        desc: '文件： ' + file.name + ' 格式错误, 请上传允许的文件.'\n      });\n    },\n    handleMaxSize (file) {\n      this.$Notice.warning({\n        title: '文件大小超过限制',\n        desc: '文件：  ' + file.name + ' 不超过' +  this.file_size + 'M'\n      });\n    },\n    // 清空内容\n    clear () {\n      this.$refs.editor.clear()\n    },\n    format (labels, selectedData) {\n      const index = labels.length - 1;\n      const data = selectedData[index] || false;\n      if (data && data.code) {\n        return labels[index] + ' - ' + data.code;\n      }\n      return labels[index];\n    },\n    query(data) {\n      var url = this.api.user.view;\n      this.$axios.post(url, data)\n        .then((response) => {\n          if (response.data.code == 0)\n          {\n            this.$Message.success('操作成功');\n          }else{\n            this.$Message.error(response.data.msg);\n          }\n        })\n    },\n    gotoPage: function(name, params = {}){\n      this.$router.push({  //核心语句\n        name:name,   //跳转的路径\n        query:params,   //跳转的参数\n      })\n    },\n    handleSubmit (name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n          let data = this.formItem\n          let attribute = JSON.stringify(this.attribute)\n          let album = JSON.stringify(this.album)\n          data.attribute = attribute\n          data.album = album\n          var url = this.api.content.save + this.contentType + '/' + this.formItem.id;\n          this.$axios.post(url, data)\n            .then((response) => {\n              if (response.data.code == 0)\n              {\n                this.$Message.success('操作成功');\n                setTimeout(() => {\n                  this.gotoPage(this.contentType)\n                }, 1000)\n              }else{\n                this.$Message.error(response.data.msg);\n              }\n            })\n        } else {\n          this.$Message.error('请正确输入表单内容');\n        }\n      })\n    },\n    handleReset (name) {\n      this.$refs[name].resetFields();\n    }\n  }\n}\n",{"version":3,"sources":["CaseView.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CaseView.vue","sourceRoot":"src/views/content","sourcesContent":["<template>\r\n    <div class=\"content\">\r\n        <Card :bordered=\"false\">\r\n            <Tabs value=\"name1\">\r\n                <TabPane label=\"基本信息\" name=\"name1\">\r\n                    <p slot=\"title\"></p>\r\n                    <Form ref=\"formItem\" :model=\"formItem\" :rules=\"ruleValidate\" :label-width=\"80\">\r\n                        <FormItem label=\"所属栏目\" prop=\"category_id\">\r\n                            <Cascader :data=\"cascader\" v-model=\"formItem.category_id\" :filterable=\"true\" change-on-select></Cascader>\r\n                            <p>所属栏目必选，发布到顶级栏目可以选择无上级</p>\r\n                        </FormItem>\r\n                        <FormItem label=\"标题\" prop=\"title\">\r\n                            <Input v-model=\"formItem.title\" placeholder=\"\"></Input>\r\n                        </FormItem>\r\n                        <FormItem label=\"缩略图\" prop=\"image\">\r\n                            <Input v-model=\"formItem.image\" disabled placeholder=\"请上传缩略图\"></Input>\r\n                            <p class=\"desc\">支持上传的文件格式为 jpg·jpeg·png·gif 且文件大小不超过 {{file_size}} M</p>\r\n                            <Upload\r\n                                    ref=\"upload\"\r\n                                    :show-upload-list=\"false\"\r\n                                    :on-success=\"handleSuccess\"\r\n                                    :on-error=\"handleError\"\r\n                                    :max-size=\"file_size * 1024\"\r\n                                    :on-format-error=\"handleFormatError\"\r\n                                    :on-exceeded-size=\"handleMaxSize\"\r\n                                    :format=\"['jpg','jpeg','png', 'gif']\"\r\n                                    :action=\"uploadUrl\">\r\n                                <Button icon=\"ios-cloud-upload-outline\">上传</Button>\r\n                            </Upload>\r\n                            <Button style=\"margin-left: 100px;margin-top: -68px;\" @click=\"viewPic(formItem.image)\">查看图片</Button>\r\n                        </FormItem>\r\n                        <FormItem label=\"是否推荐\">\r\n                            <i-switch v-model=\"formItem.is_recommend\" size=\"large\">\r\n                                <span slot=\"true\">开启</span>\r\n                                <span slot=\"false\">关闭</span>\r\n                            </i-switch>\r\n                        </FormItem>\r\n                        <FormItem label=\"内容\" prop=\"content\">\r\n                            <tinymce-editor ref=\"editor\"\r\n                                            v-model=\"formItem.content\"\r\n                            >\r\n                            </tinymce-editor>\r\n                        </FormItem>\r\n\r\n                        <FormItem>\r\n                            <FormItem>\r\n                                <Button type=\"primary\" @click=\"handleSubmit('formItem')\">保存</Button>\r\n                                <Button @click=\"handleReset('formItem')\" style=\"margin-left: 8px\">重置</Button>\r\n                            </FormItem>\r\n                        </FormItem>\r\n                    </Form>\r\n                </TabPane>\r\n                <TabPane label=\"属性\" name=\"name2\">\r\n                    <div class=\"ivu-form ivu-form-label-right\">\r\n                        <div style=\"margin: 10px 0 20px\" v-for=\"(item, index) in attribute\" :key=\"index\">\r\n                            <label class=\"ivu-form-item-label\" style=\"width: 80px;\">{{item.name }}</label>\r\n                            <div class=\"ivu-form-item-content\" style=\"margin-left: 80px;\">\r\n                                <div data-v-2a320a54=\"\" class=\"ivu-input-wrapper ivu-input-wrapper-default ivu-input-type\">\r\n                                    <input v-model=\"item['value']\" class=\"ivu-input ivu-input-default\">\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </TabPane>\r\n                <TabPane label=\"相册\" name=\"name3\">\r\n                    <Row style=\"margin: 20px\">\r\n                        <Col :lg=\"8\" :md=\"24\">\r\n                            <div style=\"width: 300px\">\r\n                                <Carousel loop v-if=\"album.length > 0\">\r\n                                    <CarouselItem v-for=\"(item, index) in album\"  :key=\"index\">\r\n                                        <div class=\"demo-carousel\"><img :src=\"item.src\"></div>\r\n                                    </CarouselItem>\r\n                                </Carousel>\r\n                            </div>\r\n                            <p style=\"margin: 15px 0;\" class=\"desc\">最多可以上传 <Tag color=\"warning\">{{albumCount}}</Tag> 个图片, 您已上传 <Tag color=\"green\">{{album.length}}</Tag>个</p>\r\n                            <p style=\"margin: 15px 0;\" class=\"desc\">支持上传的文件格式为 <Tag>jpg·jpeg·png·gif</Tag> 且文件大小不超过 <Tag>{{file_size}}</Tag> M</p>\r\n                            <p style=\"margin: 15px 0;\" class=\"desc\" v-if=\"album.length > 0\">\r\n                                已上传 <Tag color=\"success\">{{album.length}}</Tag> 张图片，\r\n                                <Button type=\"error\" @click.native=\"resetAlbum\" style=\"margin: 10px 0\" icon=\"md-close\">\r\n                                    清空相册继续上传图片\r\n                                </Button>\r\n                            </p>\r\n                            <Upload v-show=\"albumUpload\"\r\n                                    type=\"drag\"\r\n                                    ref=\"upload\"\r\n                                    :show-upload-list=\"false\"\r\n                                    :on-success=\"handleSuccessAlbum\"\r\n                                    :on-error=\"handleError\"\r\n                                    :max-size=\"file_size * 1024\"\r\n                                    :on-format-error=\"handleFormatError\"\r\n                                    :on-exceeded-size=\"handleMaxSize\"\r\n                                    :format=\"['jpg','jpeg','png', 'gif']\"\r\n                                    :action=\"uploadUrl\">\r\n                                <div style=\"padding: 30px 0\">\r\n                                    <Icon type=\"ios-cloud-upload\" size=\"200\" style=\"color: #3399ff\"></Icon>\r\n                                    <p>点击选择或拖动文件到此处上传</p>\r\n                                </div>\r\n                            </Upload>\r\n                        </Col>\r\n                    </Row>\r\n\r\n                </TabPane>\r\n            </Tabs>\r\n        </Card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n  import TinymceEditor from '../../components/Tinymce'\r\n  export default {\r\n    components: {\r\n      TinymceEditor\r\n    },\r\n    data () {\r\n      return {\r\n        albumCount: 5,\r\n        albumUpload: true,\r\n        file_size: JSON.parse(localStorage.getItem('config')).file_size,\r\n        uploadUrl: this.api.common.upload,\r\n        contentType: 'case',\r\n        cascader: [],\r\n        data:[],\r\n        attribute:[],\r\n        album: [],\r\n        formItem: {\r\n          id: 0,\r\n          title: '',\r\n          is_offer: false,\r\n          is_recommend: false,\r\n          image: '',\r\n          content: '',\r\n          category_id: [0],\r\n        },\r\n        ruleValidate: {\r\n          title: [\r\n            { required: true, message: '标题不能为空', trigger: 'blur' },\r\n            { type: 'string', min: 2, message: '标题必须大于 2 个字', trigger: 'blur' },\r\n            { type: 'string', max: 200, message: '标题必须小于200 个字', trigger: 'blur' },\r\n          ],\r\n        }\r\n      }\r\n    },\r\n    created() {\r\n      this.uploadUrl = this.uploadUrl + '?module=' + this.contentType\r\n      this.attribute = JSON.parse(localStorage.getItem('config'))['product_attribute']\r\n\r\n      // 所属栏目\r\n      var url = this.api.category.cascaderContent + this.contentType;\r\n      this.$axios.get(url)\r\n        .then((response) => {\r\n          if (response.data.code == 0)\r\n          {\r\n            this.cascader = response.data.data\r\n          }else{\r\n            this.$Message.error('数据获取失败，请检查');\r\n          }\r\n        })\r\n      //表单内容\r\n      if (this.$route.query.id > 0)\r\n      {\r\n        this.$axios.get(this.api.content.view + this.contentType + '/' + this.$route.query.id)\r\n          .then((response) => {\r\n            if (response.data.code == 0)\r\n            {\r\n              this.formItem = response.data.data\r\n              if (response.data.data.attribute != null && JSON.parse(response.data.data.attribute).length > 0)\r\n              {\r\n                let attribute = JSON.parse(response.data.data.attribute)\r\n                for (let i = 0; i < attribute.length; i++) {\r\n                  this.attribute[i] = attribute[i]\r\n                }\r\n              }\r\n              if (response.data.data.album != null)\r\n              {\r\n                let album = JSON.parse(response.data.data.album)\r\n                this.album = album\r\n                this.albumUpload = album.length >= this.albumCount ? false : true\r\n              }\r\n            }else{\r\n              this.$Message.error('数据获取失败，请检查');\r\n            }\r\n          })\r\n      }\r\n    },\r\n    methods: {\r\n      resetAlbum () {\r\n        this.albumUpload = true\r\n        this.album = []\r\n      },\r\n      imgUrl(src)\r\n      {\r\n        window.console.log(src.length)\r\n        if(src.length <= 0)\r\n        {\r\n          this.$Message.error('尚未上传图片，无法查看')\r\n          return false\r\n        }\r\n        if(src.substr(0,4).toLowerCase() != \"http\")\r\n        {\r\n          src = this.api.static.baseUrl + src;\r\n        }\r\n        return src\r\n      },\r\n      viewPic (src) {\r\n        if(src.length <= 0)\r\n        {\r\n          this.$Message.error('尚未上传图片，无法查看')\r\n          return false\r\n        }\r\n        src = this.imgUrl(src)\r\n        const title = '查看图片';\r\n        const content = '<img style=\"width: 88%\" src=\"' + src +'\">';\r\n        this.$Modal.info({\r\n          title: title,\r\n          content: content\r\n        });\r\n      },\r\n      handleSuccessAlbum (response) {\r\n        this.album.push({\r\n          src: this.imgUrl(response.data.url)\r\n        })\r\n        if(this.album.length > this.albumCount - 1)\r\n        {\r\n          this.albumUpload = false\r\n        }\r\n        this.$Message.success('上传成功')\r\n      },\r\n      handleSuccess (response) {\r\n        this.formItem.image = response.data.url\r\n        this.$Message.success('上传成功')\r\n      },\r\n      handleVideoSuccess (response) {\r\n        this.formItem.video = response.data.url\r\n        this.$Message.success('上传成功')\r\n      },\r\n      handleError (event) {\r\n        window.console.log(event)\r\n        this.$Message.error('上传错误，请重新上传')\r\n\r\n      },\r\n      handleFormatError (file) {\r\n        this.$Notice.warning({\r\n          title: '文件格式错误',\r\n          desc: '文件： ' + file.name + ' 格式错误, 请上传允许的文件.'\r\n        });\r\n      },\r\n      handleMaxSize (file) {\r\n        this.$Notice.warning({\r\n          title: '文件大小超过限制',\r\n          desc: '文件：  ' + file.name + ' 不超过' +  this.file_size + 'M'\r\n        });\r\n      },\r\n      // 清空内容\r\n      clear () {\r\n        this.$refs.editor.clear()\r\n      },\r\n      format (labels, selectedData) {\r\n        const index = labels.length - 1;\r\n        const data = selectedData[index] || false;\r\n        if (data && data.code) {\r\n          return labels[index] + ' - ' + data.code;\r\n        }\r\n        return labels[index];\r\n      },\r\n      query(data) {\r\n        var url = this.api.user.view;\r\n        this.$axios.post(url, data)\r\n          .then((response) => {\r\n            if (response.data.code == 0)\r\n            {\r\n              this.$Message.success('操作成功');\r\n            }else{\r\n              this.$Message.error(response.data.msg);\r\n            }\r\n          })\r\n      },\r\n      gotoPage: function(name, params = {}){\r\n        this.$router.push({  //核心语句\r\n          name:name,   //跳转的路径\r\n          query:params,   //跳转的参数\r\n        })\r\n      },\r\n      handleSubmit (name) {\r\n        this.$refs[name].validate((valid) => {\r\n          if (valid) {\r\n            let data = this.formItem\r\n            let attribute = JSON.stringify(this.attribute)\r\n            let album = JSON.stringify(this.album)\r\n            data.attribute = attribute\r\n            data.album = album\r\n            var url = this.api.content.save + this.contentType + '/' + this.formItem.id;\r\n            this.$axios.post(url, data)\r\n              .then((response) => {\r\n                if (response.data.code == 0)\r\n                {\r\n                  this.$Message.success('操作成功');\r\n                  setTimeout(() => {\r\n                    this.gotoPage(this.contentType)\r\n                  }, 1000)\r\n                }else{\r\n                  this.$Message.error(response.data.msg);\r\n                }\r\n              })\r\n          } else {\r\n            this.$Message.error('请正确输入表单内容');\r\n          }\r\n        })\r\n      },\r\n      handleReset (name) {\r\n        this.$refs[name].resetFields();\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n    .demo-carousel\r\n    {\r\n        height: 300px;\r\n        width: 300px;\r\n        line-height: 200px;\r\n        text-align: center;\r\n        color: #fff;\r\n        font-size: 20px;\r\n        background: #506b9e;\r\n    }\r\n    .demo-carousel img{\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n</style>"]}]}